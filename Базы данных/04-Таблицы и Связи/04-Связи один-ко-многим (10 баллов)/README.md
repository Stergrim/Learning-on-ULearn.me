# Связи один-ко-многим

В блоге авиокомпании стало сложно ориентироваться из-за большого количества статей. Было решено добавить рубрикатор. Для этого понадобится создать справочник рубрик (article_rubrics) и научиться связывать статьи с рубриками.

| **Описание**     | **Название**      | **Тип**     | **Обязательность** | **Комментарий**                  |
|:-----------------|:------------------|:------------|:-------------------|:---------------------------------|
| ID               | article_rubric_id | Целое число | +                  | Первичный ключ с автоинкрементом |
| Название рубрики | title             | Строка(255) | +                  | Все названия уникальные          |                      

**Тестовые данные**

```pgsql
INSERT INTO article_rubrics (title)
VALUES ('Новости'), ('Вебинары'), ('Скидки');
```

**Задание**
1. [Освежи знания по настройке внешних ключей](https://postgrespro.ru/docs/postgresql/13/ddl-constraints#DDL-CONSTRAINTS-FK).
2. Создай таблицу для справочника рубрик.
3. Заполните справочник тестовыми данными.
4. В таблицу статей добавь колонку для связи с рубриками (article_rubric_id).
5. Добавь ограничение внешнего ключа на связь. Сделай так, чтобы:
   - при изменении ID рубрики, связанные статьи автоматически меняли связь;
   - нельзя было удалить рубрику, если есть статьи, связанные с ней.
6. Свяжи все статьи с нечётными идентификаторами с рубрикой 'Новости', а остальные, с рубрикой 'Вебинары'.
7. Получи все статьи и их рубрики. **Формат вывода:** ИД статьи | ID рубрики | Название рубрики

**Примечание 1**

Связь записи одной таблицы с несколькими записями другой таблицы называется связью “один-ко-многим” (“многие-к-одному”).

Связь может быть обязательной или нет, т.е. колонка, которая ссылается, может быть NULL или NOT NULL.

**Примечание 2**

Можно было не создавать отдельный справочник, а просто добавить колонку с названием рубрики в таблицу статей. Но это привело бы к дублированию данных и нарушению первой нормальной формы (см. в следующих заданиях). Это станет особенно актуально, когда мы захотим добавить каких-то свойств самой рубрике.

**Контрольные вопросы**
- Для чего нужен внешний ключ?
- Какие настройки у ключа есть? Какие ограничения при удалении и при изменении?
- В каких ситуациях какой тип ограничения удаления / изменения стоит использовать?
- Синтаксис создания индекса.

**Все тесты пройдены, задача сдана:**
```pgsql
-- Создаем таблицу для справочника рубрик
Create Table article_rubrics (
    article_rubric_id Serial Primary Key,
    title Varchar(255) Not Null Unique
);

-- Заполняем справочник тестовыми данными
Insert Into article_rubrics (title)
Values ('Новости'), ('Вебинары'), ('Скидки');

-- Добавляем колонку для связи с рубриками
Alter Table articles 
Add Column article_rubric_id Integer;

-- Добавляем ограничение внешнего ключа
Alter Table articles 
Add Constraint fk_articles_rubrics 
Foreign Key (article_rubric_id) 
References article_rubrics (article_rubric_id)
On Update Cascade
On Delete Restrict;

-- Связываем статьи с нечётными ID с рубрикой 'Новости' (ID=1)
Update articles 
Set article_rubric_id = 1 
Where article_id % 2 = 1;

-- Связываем статьи с чётными ID с рубрикой 'Вебинары' (ID=2)
Update articles 
Set article_rubric_id = 2 
Where article_id % 2 = 0;

-- Получаем все статьи и их рубрики
Select 
    article_id as "ИД статьи",
    article_rubric_id as "ID рубрики",
    ar.title as "Название рубрики"
From articles
Left Join article_rubrics as ar Using(article_rubric_id)
Order by article_id;
```
