# Сортировка и фильтрация

**Общий принцип**

Для оптимизации запроса с фильтрацией и сортировкой в общем случае сделай общий индекс на все колонки, которые участвуют в фильтрации и сортировке.

Важен порядок колонок в индексе – сначала должны идти колонки из WHERE, затем колонки из ORDER BY.

Например, для запроса `SELECT * FROM table WHERE f1='a' AND f2='b' ORDER BY f3 DESC, f4 ASC`

В общем случае оптимальным будет индекс `INDEX (f1, f2, f3 DESC, f4 ASC)`.

Как и в других ситуациях, в некоторых случаях БД может использовать индексы с меньшим количеством колонок, например: `INDEX (f1, f2, f3 DESC)`, `INDEX (f1, f2)`, `INDEX (f1)`, `INDEX (f2)`.

**Задание**

Выполняй запросы в PGAdmin на демо-базе. Предварительно удали все индексы на таблице flights.
1. Выбери последние 10 приземлившихся рейсов в Новосибирске: `SELECT * FROM flights WHERE status='Arrived' AND arrival_airport='NSK' ORDER BY actual_arrival DESC LIMIT 10`
2. Посмотри план запроса.
3. Какой индекс должен быть наиболее оптимальный и почему?
4. Последовательно создай индексы. Проверяй план выполнения, оценки стоимость, типы доступа.
   - status
   - arrival_airport
   - status, arrival_airport
   - arrival_airport, status
   - status, arrival_airport, actual_arrival DESC
   - arrival_airport, status, actual_arrival DESC
5. В ответ запиши, какой индекс самый оптимальный. Перечисли колонки через запятую. Укажи направление сортировки в нужных колонках.

**Все тесты пройдены, задача сдана:**
```pgsql
arrival_airport, status, actual_arrival Desc
```
